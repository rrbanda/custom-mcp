# yaml-language-server: $schema=https://raw.githubusercontent.com/rrbanda/gen-mcp/refs/heads/main/specs/mcpfile-schema.json
kind: MCPToolDefinitions
schemaVersion: "0.2.0"
name: process-tools
version: "1.0.0"
instructions: |
  This MCP server provides tools for process automation - calling backend APIs for various workflows.
  
  Available tool categories:
  - Certificate Orders: Create and manage certificate requests
  - (Extensible) Add more tools for any API-driven process
  
  Authentication:
  All tools require a token parameter which is sent as:
  - CMP_AUTH_TOKEN header
  - Authorization: Bearer header
  
  To add new tools, define them in this file with their input schema and invocation details.

invocationBases:
  # =============================================================================
  # BASE AUTH CONFIG - Shared across ALL CMP tools
  # =============================================================================
  # This base provides common auth headers matching the actual CMP API format.
  # Headers: CMP_AUTH_TOKEN and Authorization Bearer token
  baseCmpAuth:
    http:
      method: POST  # Default method, can be overridden
      url: ${CMP_BACKEND_URL}
      headers:
        Content-Type: "application/json"
        CMP_AUTH_TOKEN: "{token}"
        Authorization: "Bearer {token}"

  # =============================================================================
  # CERTIFICATE ORDERS BASE - For certificate-related operations
  # =============================================================================
  baseCertOrders:
    http:
      method: POST
      url: ${CMP_BACKEND_URL}/api/orderextws/public/Orders
      headers:
        Content-Type: "application/json"
        CMP_AUTH_TOKEN: "{token}"
        Authorization: "Bearer {token}"

  # =============================================================================
  # ADD MORE BASES HERE FOR OTHER CMP TYPES
  # =============================================================================
  # Example for future CMPs:
  # 
  # baseNetworkCmp:
  #   http:
  #     method: POST
  #     url: ${CMP_BACKEND_URL}/api/network/v1
  #     headers:
  #       Content-Type: "application/json"
  #       Username: "{username}"
  #       Token: "{token}"
  #       SM_USER_DEV: "{smUserDev}"

# =============================================================================
# COMMON INPUT SCHEMA FRAGMENTS (for reference when adding new tools)
# =============================================================================
# All CMP tools should include this auth field in their inputSchema:
#
#   token:
#     type: string
#     description: "Authentication token for the CMP API"
#
# The token is used to populate both headers:
#   - CMP_AUTH_TOKEN: {token}
#   - Authorization: Bearer {token}
#
# And include it in required: [token, ...]

tools:
  # ===========================================================================
  # CERTIFICATE ORDER TOOLS
  # ===========================================================================
  - name: create_certificate_order
    title: "Create Certificate Order"
    description: |
      Creates a new certificate order in the Certificate Management Platform.
      
      This tool submits a certificate request with the specified questionnaire data.
      Common questionnaire fields include:
      - Environment (DEV, PROD, etc.)
      - commonName (the certificate CN)
      - flatSubjectAlternativeNames (SANs)
      - templateAliasDEV (certificate template)
      - ApplicationOwner
      - location, stateprovince, countryC
      
      Note: The token is used for authentication headers (CMP_AUTH_TOKEN and Authorization Bearer).
    inputSchema:
      type: object
      properties:
        # --- AUTH FIELD ---
        token:
          type: string
          description: "Authentication token for the CMP API (used in CMP_AUTH_TOKEN and Authorization headers)"
        # --- ORDER FIELDS ---
        orderByGeid:
          type: string
          description: "GEID of the person placing the order"
        orderForGeid:
          type: string
          description: "GEID of the person the order is for (can be same as orderByGeid)"
        productId:
          type: string
          description: "Product identifier (e.g., 39673_523779_GLOBAL)"
        productName:
          type: string
          description: "Product name (e.g., Next Generation CORTOSIS - Certificate management)"
        questionnaire:
          type: array
          description: "Array of questionnaire responses for the certificate order"
          items:
            type: object
            properties:
              dataKey:
                type: string
                description: "Unique identifier for the field (e.g., 39673_523779_5458583)"
              key:
                type: string
                description: "Field name (e.g., Environment, commonName, location)"
              IsHidden:
                type: string
                description: "Whether the field is hidden ('true' or 'false' as string)"
              value:
                type: array
                description: "Array containing the field value(s)"
                items:
                  type: string
              searchInput:
                type: string
                description: "Optional search input used to find the value"
              autoPopulated:
                type: boolean
                description: "Whether the field was auto-populated"
            required:
              - dataKey
              - key
              - IsHidden
              - value
      required:
        - token
        - orderByGeid
        - orderForGeid
        - productId
        - productName
        - questionnaire
    invocation:
      extends:
        from: baseCertOrders
        extend:
          url: "/createOrder"

  # ===========================================================================
  # GET CERTIFICATE STATUS
  # ===========================================================================
  - name: get_certificate_status
    title: "Get Certificate Status"
    description: |
      Retrieves the current status of a certificate order.
      
      Use this tool when you need to:
      - Check if a certificate order has been approved
      - Get the current processing state
      - Retrieve order details
      
      Returns the order status, creation date, and any error messages.
    inputSchema:
      type: object
      properties:
        # --- AUTH FIELD ---
        token:
          type: string
          description: "Authentication token for the CMP API"
        # --- TOOL-SPECIFIC FIELDS ---
        orderId:
          type: string
          description: "The order ID to check status for (e.g., ORD-12345)"
      required:
        - token
        - orderId
    invocation:
      extends:
        from: baseCertOrders
        extend:
          url: "/{orderId}/status"
        override:
          method: GET

  # ===========================================================================
  # ADD MORE TOOLS HERE
  # ===========================================================================
  # Example: Different API type (network provisioning using a different base)
  #
  # - name: create_network_request
  #   title: "Create Network Request"
  #   description: "Creates a network provisioning request"
  #   inputSchema:
  #     type: object
  #     properties:
  #       username:
  #         type: string
  #       token:
  #         type: string
  #       smUserDev:
  #         type: string
  #       networkType:
  #         type: string
  #       vlanId:
  #         type: string
  #     required: [username, token, smUserDev, networkType]
  #   invocation:
  #     extends:
  #       from: baseNetworkCmp  # Different base for different API type
  #       extend:
  #         url: "/provision"
